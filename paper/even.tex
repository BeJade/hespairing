\section{Even embedding degrees}
\label{sec:even}

This section provides formulas for computing point doubling, point addition,
and line functions for pairing on twisted Hessian curves with even embedding degrees.
Recall the twisted Hessian curve equation in projective coordinates
$$ \mathcal{H}: a' X^3 + Y^3 + Z^3 = 0. $$
%Formulas presented in this section work under an assumption that the curve parameter $d' = 0$.

We denote operations in the base field, namely, 
field multiplication, field squaring and field multiplication by the curve parameter $a'$
by $\mul, \sqr, \mulp{a}$ respectively.
We denote the embedding degree by $k$ and the twist degree by $d=3$.

%The following formulas work for both Tate and ate pairings.
We denote a point $P = (X_1,Y_1,1)$ and a point $R = (X_2,Y_2,Z_2)$ on $E/\F{q}$
and a point $Q = (X_{Q},Y_{Q},1)$ on $E/\F{q^{k/d}}$. % where $Y_Q \in \F{q^{k/d}}$.
Note that the points $P$ and $Q$ do not change throughout the pairing computation.
Therefore, these points can be preprocessed, and we assume that the $Z_1 = Z_{Q} = 1$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Doubling}
First, we show formulas for point doubling.
These formulas work under the condition that the curve parameter $d'=0$,
which is the case for pairing-friendly twisted Hessian generated by our constructions.
Let $R = (X_1, Y_1, Z_1)$.
The following formulas compute the doubling of a point $R$ to $2R = (X_3,Y_3,Z_3)$.
\begin{align*}
T &= Y_1^2;\	\qquad	A = Y_1 \cdot T;\	\qquad
S = Z_1 ^ 2;\	\qquad	B = Z_1 \cdot S;\\
X_3 &= X_1 \cdot (A - B);\	\quad
Y_3 = -Z_1 \cdot (2A + B);\	\quad
Z_3 = Y_1 \cdot (A + 2B).
\end{align*}
The above formulas for computing point doubling
cost $5\mul + 2\sqr$. % + 2\mulp{2} + 3\add$ plus one negation.

Let $Q = (X_{Q}, Y_{Q}, 1)$ be the point at which we evaluate.
Let $R$ and $2R$ be as defined above for point doubling.
The associated line function for doubling
($l_{2R}(Q)$ in Algorithm~\ref{algo:miller})
is computed as
$$ l = a X_1^2 X_{Q} + T \cdot Y_{Q} + S $$
%\begin{align*}
%l_1 &= a X_1^2 X_{Q} + T \cdot Y_{Q} + S;\		\qquad
%l_a = X_3 \cdot Y_{Q} + X_3;			\\
%l_b &= X_{Q} \cdot (Y_3 + Z_3);\			\qquad
%l_c = l_a^2 + l_b \cdot (l_a + l_b);\		\qquad
%l = l_1 \cdot l_c.
%\end{align*}
%To compute the line function for doubling,
%it costs 
which costs
%$\frac{k}{3}(6\mul + \sqr) + \sqr + \mulp{a}$.
%$k(\frac{14}{3}\mul + \frac{1}{3}\sqr) + \sqr + \mul_a$.
$\frac{2}{3}k\mul + \sqr + \mul_a$.
Therefore, the total number of operations for the ``doubling step''
({line 3} in Algorithm~\ref{algo:miller}) in the pairing computation is
%$\frac{k}{3}(6\mul + \sqr) + 5\mul +3\sqr + \mulp{a}$.
%$k(\frac{14}{3}\mul + \frac{1}{3}\sqr) + 5\mul +3\sqr + \mul_a$.
$\frac{2}{3}k\mul + 5\mul +3\sqr + \mul_a$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Addition}
Let $P = (X_1,Y_1,1)$ and $R = (X_2,Y_2,Z_2)$.
The following formulas compute the addition of points
$P + R = (X_1,Y_1,1) + (X_2,Y_2,Z_2) = (X_3,Y_3,Z_3)$.
\begin{align*}
A &= X_1 \cdot Z_2;\	\qquad
C = Y_1 \cdot X_2;\	\qquad
D = Y_1 \cdot Y_2;\	\qquad
F = a X_1 \cdot X_2;\\
G &= (D + Z_2) \cdot (A - C);\	\quad
H = (D - Z_2) \cdot (A + C);\\
J &= (D + F) \cdot (A - Y_2);\	\quad
K = (D - F) \cdot (A + Y_2);\\
X_3 &= G - H;\	\qquad
Y_3 = K - J;\\
Z_3 &= J + K - G - H - 2(Z_2 - F) \cdot (C + Y_2).
\end{align*}
The above formulas for computing point addition
cost $9\mul + \mulp{a}$.

Let $Q = (X_{Q},Y_{Q},1)$ be the point at which we evaluate.
Let $P,R,(P+R)$ be as defined above for point addition.
The associated line function for addition
($l_{R,P}$ in Algorithm~\ref{algo:miller})
is computed as
$$l = (Y_1 \cdot Z_2 - Y_2) \cdot (X_1 - X_{Q}) + (Y_{Q} - Y_1) \cdot (X_1 \cdot Z_2 - X_2) $$
%\begin{align*}
%l_1 &= (Y_1 \cdot Z_2 - Y_2) \cdot (X_1 - X_{Q}) + (Y_{Q} - Y_1) \cdot (X_1 \cdot Z_2 - X_2);\\
%l_a &= Y_{Q} \cdot X_3 + X_3;\	\quad
%l_b = X_{Q} \cdot (Y_3 + Z_3);\	\quad
%l_c = l_a^2 + l_a \cdot (l_b + l_b);\\
%l &= l_1 \cdot \l_c.
%\end{align*}
%To compute the line function for addition,
%it costs
which costs
%$\frac{k}{3}(6\mul + \sqr) + 2\mul$.
%$k(\frac{14}{3}\mul + \frac{1}{3}\sqr) + 2\mul$.
$\frac{2}{3}k\mul + 1\mul$.
Therefore, the total number of operations for the ``addition step''
({line 6} in Algorithm~\ref{algo:miller}) in the pairing computation is
%$\frac{k}{3}(6\mul + \sqr) + 11\mul + \mulp{a}$.
%$k(\frac{14}{3}\mul + \frac{1}{3}\sqr) + 11\mul + \mul_a$.
$\frac{2}{3}k\mul + 10\mul + \mul_a$.

\subsection{Line functions for pairings on $\G{1} \times \G{2}$}

Recall that Miller's algorithm computes the line function 
$\ell_{P_1,P_2}(Q) = l_{P_1,P_2}(Q)/v_{P_1 + P_2}(Q)$;
for pairings on $\G{1} \times \G{2}$ we have that $P_1, P_2 \in \G{1}$ and $Q \in \G{2}$.

To avoid the field inversion we apply the denominator elimination technique of \cite{GGX10},
described briefly below. 
It is shown in \cite[Section 4]{GGX10} that if
$\alpha \in \F{q^k} \setminus \F{q^{k/2}}$, then
without loss of generality we may assume that a point
$Q \in E(\F{q^k})$ is of the form
$Q = (c+d\alpha, c-d\alpha )$, where
$c, d \in \F{q^{k/2}}$.
In particular, the line $v_R$ passing through $R = (x,y) \in E(\F{q})$ 
and $-R = (x/y, 1/y)$ evaluated at $Q$ is given by
$2c(y-x) + x^2-y^2 \in \F{q^{k/2}}$.
Hence in the final exponentiation step of Miller's algorithm the denominator will become 1,
therefore can be ignored.

So, we replace the line funtion $\ell_{P_1,P_2}(Q)$ by just $l_{P_1,P_2}(Q)$, which is of the form

$$ (Y_1 \cdot Z_2 - Y_2) \cdot (X_1 - X_{Q}) + (Y_{Q} - Y_1) \cdot (X_1 \cdot Z_2 - X_2) $$,

where $P_1 = [X_1:Y_1:Z_1]$, $P_2 = [X_2:Y_2:Z_2]$, and $Q = [X_Q:Y_Q:Z_Q]$;
here the multiplications in $\F{q}$ were performed during the point addition process.

Let
$$ \mathcal{H}_{\omega}: a' \omega^3 X^3 + Y^3 + Z^3 = 0, $$
where $\omega \in \F{q^k} \setminus \F{q^{k/3}}$ and $\omega^3 \in \F{q^{k/3}}$.
Then $\mathcal{H}_{\omega}$ is a degree 3 twist of $\mathcal{H}$; the two curves are isomorphic via
\[\begin{array}{rccc}
\varphi: & \mathcal{H}_{\omega} & \rightarrow & \mathcal{H} \\
& [X:Y:Z] & \mapsto & [\omega X:Y:Z].
\end{array}\]
In particular, if $Q' \in \mathcal{H}_{\omega}(\F{q^{k/3}})$, then
$\varphi(Q') \in \mathcal{H}(\F{q^k}) \setminus \mathcal{H}(\F{q^{k/3}})$.
Analogously to \cite{??}, choosing $Q = \varphi(Q')$ gives no loss of security.
So set $Q' = [X_Q':Y_Q':Z_Q']$ and $Q = \varphi(Q')$. 
Then $l_{P_1,P_2}(Q)$ can be computed as

\textbf{Chloe: this is just copied from above; need to check/rewrite taking twists into account}

$$ (Y_1 \cdot Z_2 - Y_2) \cdot X_1 + (Y_{Q'} - Y_1) \cdot (X_1 \cdot Z_2 - X_2) - (Y_1 \cdot Z_2 - Y_2) \cdot X_{Q'}\omega  $$,
which amounts to two multiplications of an element of $\F{q}$ with an element of $\F{q^{k/3}}$,
costing $2\cdot \frac{k}{3} \mul$ with schoolbook multiplication.
Furthermore, multiplying a general element of $\F{q^k}$ with $l_{P_1,P_2}(Q)$ will cost only
$6 \left(\frac{k}{3}\right)^2 \mul = \frac{2}{3}M$ as the coefficient of $\omega^2$ in $l_{P_1,P_2}(Q)$ is zero.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Comparison}

%We would like to emphasize that:
%\begin{itemize}
%\item	Most of the previous works concerned Weierstrass curves.
%\item	Most of the previous works concerned even embedding degrees.
%\item	There were some previous works on Hessian curves but with even embedding degrees.
%\item	There were also some previous works with odd embedding degrees but using Weierstrass curves.
%\end{itemize}
%Therefore, it is difficult to have an appropriate comparison between the constructions in this paper and previous works,
%as we are the first, to our knowledge, to consider the twisted Hessian curves with odd embedding degrees.
%Note that even embedding degrees have the advantage of being able to completely eliminate denominators in the computation of the pairing.
%However, with odd embedding degrees, we need to compute the denominator as it is non-trivial.
%%Hence, it is challenging to have the cost of odd embedding degrees being competitive with those of even embedding degrees.

Table~\ref{tbl-even} shows the costs of the computation of pairings using our constructions in comparison with previous works.
%The first column gives the parity of the embedding degree $k$.
The first column gives the curve models, where 
$\mathcal{J}$, $\mathcal{P}$, $\mathcal{E}$, $\mathcal{H}$ denote the
Weierstrass model with Jacobian coordinates, the
Weierstrass model with projective coordinates,
the Edwards model and the
Hessian model respectively.
Note that this work considers the generalization of Hessian curves to ``twisted'' Hessian curves, and that the twists are of degree 3.
The second and third columns show the cost of doubling (DBL) and mixed addition (mADD) including the computation of the line functions for pairing computations.
By `mixed addition' we mean that the $z$ coordinate is set to be 1.
We denote the cost of field multiplication and field squaring over the base field $\F{q}$ by $\mul$ and $\sqr$ respectively.
The cost of multiplication by curve parameters is omitted from the table.

\begin{table}[h]
\centering
\caption{Comparison of the cost for computing pairings on different curve models with even embedding degrees}

\begin{tabular}{ l | l | l}
\hline
\multicolumn{1}{c|}{Curve models}	&\multicolumn{1}{c|}{DBL}	&\multicolumn{1}{c}{mADD}	\\
\hline
$\mathcal{J}$, \cite{2008/IonicaJoux08} \cite{2009/fastertate}
				&$\phantom{\frac{2}{3}}k\mul + 1\mul + 11\sqr$			&$\phantom{\frac{2}{3}}k\mul + \phantom{0}6\mul + 6\sqr$	\\
$\mathcal{J},a = -3$, \cite{2009/fastertate}
				&$\phantom{\frac{2}{3}}k\mul + 6\mul + \phantom{0}5\sqr$	&$\phantom{\frac{2}{3}}k\mul + \phantom{0}6\mul + 6\sqr$	\\
$\mathcal{J},a = 0$, \cite{2009/fastertate}		
				&$\phantom{\frac{2}{3}}k\mul + 3\mul + \phantom{0}8\sqr$	&$\phantom{\frac{2}{3}}k\mul + \phantom{0}6\mul + 6\sqr$	\\
$\mathcal{P},a = 0, b = c^2$, \cite{2009/craig}
				&$\phantom{\frac{2}{3}}k\mul + 3\mul + \phantom{0}5\sqr$	&$\phantom{\frac{2}{3}}k\mul + 10\mul + 2\sqr$	\\
$\mathcal{E}$, \cite{2009/fastertate}			
				&$\phantom{\frac{2}{3}}k\mul + 6\mul + \phantom{0}5\sqr$	&$\phantom{\frac{2}{3}}k\mul + 12\mul$	\\
$\mathcal{H}$, \cite{2010/Gu}	&$\phantom{\frac{2}{3}}k\mul + 3\mul + \phantom{0}6\sqr$	&$\phantom{\frac{2}{3}}k\mul + 10\mul$	\\
\hline
$\mathcal{H},d=3$, this paper
				&$\frac{2}{3}k\mul + 5\mul + \phantom{0}3\sqr$
												&$\frac{2}{3}k\mul + 10\mul$	\\
\hline
\end{tabular}
\label{tbl-even}

%\justify
%Note: ``Pre cost'' denotes the precomputation cost.
%This cost is already included in the first column.

\end{table}

Let $\Mul$ and $\Sqr$ denote the cost of field multiplication and field squaring over the extension field.
In the doubling step,
we have to compute $f^2 \cdot \ell_{2R}$.
Therefore, the extra cost of $1\Mul + 1\Sqr$ is required.
Similarly, in the addition step,
we have to compute $f \cdot \ell_{R,P}$.
Therefore, the extra cost of $1\Mul$ is required.
These extra costs are the same for all curve models regardless of the embedding degree.
Hence, we omit these costs from the table.

%Note that there are various advantages of our constructions that cannot be justified by the cost shown in Table~\ref{tbl-cmp}.
%First of all, the costs shown in Table~\ref{tbl-cmp} do not reflect the total cost for the pairing-based protocols.
%This is because generically there are many group operations performed prior to relatively few pairing computations,
%and group operations on twisted Hessian curves allow faster point arithmetic operations than Weierstrass curves.
%Secondly, having curves represented in the same models for $\mathbb{G}_1$ and $\mathbb{G}_2$ does not induce the extra cost of conversion between curve models.
%(Recall that for BN, BLS, and KSS, this conversion is always necessary if one wants to take advantage of
%the fast point-arithmetic on Hessian or Edwards curves, as proven in~\cite{2013/bos-pairing}.)
%%As explained in Section~\ref{subsec:w2h}, 
%%this conversion costs $9\Mul + 2\Sqr + 5\mul$ plus one inversion and one cube root computation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\subsection{Numerical comparison}
%Since we would like to focus on a better balance of field size and embedding degree,
%we would like to focus on odd embedding degrees with allow, for example, $k = 15, 21$.
%Therefore, we think it is the best to compare our result of odd embedding degree twist Hessian curves,
%with odd embedding degree Weierstrass curve~\cite{2010/CLN}.
%
%In many protocols based on pairings, there are usually only a few pairing computation but many operations in $\G{1}$ and less in $\G{2}$, and $\G{T}$.
%In this simple comparison analysis, we would like to focus only on exponentiation $\G{1}$ because there are more of these compared to $\G{2}$ and $\G{T}$.
%We would like to show how much we save for one exponentiation in $\G{1}$.
%
%Consider embedding degree $k = 15$.
%Let $q = 384$.
%According to~\cite{EFD} and~\cite{2013/bos-pairing}, for Weierstrass curves of a form $y^2 = x^3 + b$,
%point doubling costs $2\Mul + 5\Sqr$ and point addition costs $11\Mul + 5\Sqr$.
%For our twisted Hessian curves of a form $ax^3 + y^3 + 1 = 0$,
%point doubling costs $5\Mul + 2\Sqr$ and point additio costs $11\Mul$.
%Let consider $S = 0.8M$.
%This means that on Weierstrass curve, point doubling and point addition cost $6\Mul$ and $15\Mul$ respectively,
%while on twisted Hessian curves point doubling and point addition cost $6.6\Mul$ and $11\Mul$ respectively.
%Let consider double-and-add algorithm with window with 5.
%This means that one exponentiation costs
%$384(6\Mul) + 76(15\Mul) = 3444\Mul$ on Weierstrass curves, and
%$384(6.6\Mul) + 76(11\Mul) = 3370.4$ on twisted Hessian curves.
%One pairing on Weierstrass curves cost $15\Mul + 6\Mul + 7\Sqr = 26.6\Mul$.
%One pairing on twisted Hessian curves cost $15\Mul + 6\Mul + 7\Sqr = 26.6\Mul$.
%
%Even though pairing on odd embedding degree twisted Hessian curves might cost more than that on Weierstrass curves,
%but if we consider as a whole pairing protocols, we save more on the group operations.
%The example of numerical comparison above show this.



